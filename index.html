<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Jogo Beat'em Up</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
</head>
<body>
<script>
let player;
let enemies = [];
let trees = [];
let bullets = [];
let cameraX = 0;
let animationFrame = 0; // Para animar as pernas

function setup() {
  createCanvas(800, 400);
  // Inicializa o jogador
  player = {
    x: 100,
    y: 300,
    speed: 5,
    width: 20,
    height: 40,
    legAngle: 0,
    moving: false
  };
  // Cria árvores
  for (let i = 0; i < 10; i++) {
    trees.push({
      x: random(0, 2000),
      y: random(100, 350),
      size: 60
    });
  }
  // Cria inimigos
  for (let i = 0; i < 5; i++) {
    enemies.push({
      x: random(200, 2000),
      y: random(250, 350),
      width: 20,
      height: 40,
      speed: 2,
      alive: true,
      legAngle: 0
    });
  }
}

function draw() {
  background(100, 150, 100); // Fundo verde (grama)
  
  // Atualiza a posição da câmera
  cameraX = player.x - width / 2;
  if (cameraX < 0) cameraX = 0;
  
  // Incrementa o quadro de animação
  animationFrame += 0.1;
  
  // Aplica a transformação da câmera
  push();
  translate(-cameraX, 0);
  
  // Desenha o chão
  fill(150, 100, 50);
  rect(0, 300, 2000, 100);
  
  // Desenha árvores
  fill(139, 69, 19); // Marrom para tronco
  stroke(0);
  for (let tree of trees) {
    rect(tree.x - 10, tree.y - 20, 20, 40); // Tronco
    fill(34, 139, 34); // Verde para folhas
    ellipse(tree.x, tree.y - 30, tree.size, tree.size); // Folhas
  }
  
  // Desenha o jogador
  fill(0, 0, 255);
  drawHumanoid(player, player.moving);
  
  // Atualiza e desenha balas
  fill(255, 255, 0); // Amarelo para balas
  for (let i = bullets.length - 1; i >= 0; i--) {
    let bullet = bullets[i];
    bullet.x += bullet.speed;
    ellipse(bullet.x, bullet.y, 10, 5); // Bala como elipse pequena
    
    // Remove balas que saem da tela
    if (bullet.x > cameraX + width || bullet.x < cameraX) {
      bullets.splice(i, 1);
      continue;
    }
    
    // Verifica colisão com inimigos
    for (let j = enemies.length - 1; j >= 0; j--) {
      let enemy = enemies[j];
      if (enemy.alive && dist(bullet.x, bullet.y, enemy.x, enemy.y) < (player.width + enemy.width) / 2) {
        enemies.splice(j, 1); // Remove inimigo atingido
        bullets.splice(i, 1); // Remove bala
        break;
      }
    }
  }
  
  // Desenha e atualiza inimigos
  fill(255, 0, 0);
  for (let enemy of enemies) {
    if (enemy.alive) {
      // Movimento em direção ao jogador
      let dx = player.x - enemy.x;
      let dy = player.y - enemy.y;
      let distance = sqrt(dx * dx + dy * dy);
      if (distance > 5) {
        enemy.x += (dx / distance) * enemy.speed;
        enemy.y += (dy / distance) * enemy.speed;
        enemy.legAngle = sin(animationFrame) * 30; // Anima pernas
      }
      drawHumanoid(enemy, true); // Inimigos sempre "andando"
    }
  }
  
  pop();
  
  // Controles do jogador
  player.moving = false;
  if (keyIsDown(LEFT_ARROW)) {
    player.x -= player.speed;
    if (player.x < 0) player.x = 0;
    player.moving = true;
  }
  if (keyIsDown(RIGHT_ARROW)) {
    player.x += player.speed;
    if (player.x > 2000) player.x = 2000;
    player.moving = true;
  }
  if (keyIsDown(UP_ARROW)) {
    player.y -= player.speed;
    if (player.y < 250) player.y = 250;
    player.moving = true;
  }
  if (keyIsDown(DOWN_ARROW)) {
    player.y += player.speed;
    if (player.y > 350) player.y = 350;
    player.moving = true;
  }
  
  // Atualiza animação das pernas do jogador
  if (player.moving) {
    player.legAngle = sin(animationFrame) * 30; // Ângulo oscilante para pernas
  } else {
    player.legAngle = 0; // Pernas paradas
  }
}

// Função para desenhar figura humanoide
function drawHumanoid(entity, isMoving) {
  push();
  translate(entity.x, entity.y);
  
  // Corpo
  rect(-entity.width / 2, -entity.height / 2, entity.width, entity.height);
  
  // Cabeça
  ellipse(0, -entity.height / 2 - 10, entity.width, entity.width);
  
  // Braços (estáticos)
  line(-entity.width / 2, -entity.height / 4, -entity.width - 10, 0);
  line(entity.width / 2, -entity.height / 4, entity.width + 10, 0);
  
  // Pistola na mão direita do jogador
  if (entity === player) {
    fill(100); // Cinza para pistola
    rect(entity.width / 2 + 10, -5, 10, 5); // Pistola como retângulo
  }
  
  // Pernas (animadas se em movimento)
  push();
  translate(-entity.width / 4, entity.height / 2);
  rotate(radians(isMoving ? entity.legAngle : 0));
  line(0, 0, 0, 20);
  pop();
  
  push();
  translate(entity.width / 4, entity.height / 2);
  rotate(radians(isMoving ? -entity.legAngle : 0));
  line(0, 0, 0, 20);
  pop();
  
  pop();
}

// Atirar com a tecla Espaço
function keyPressed() {
  if (keyCode === 32) { // Tecla Espaço
    bullets.push({
      x: player.x + player.width / 2 + 15, // Começa na ponta da pistola
      y: player.y,
      speed: 10
    });
  }
}
</script>
</body>
</html>
